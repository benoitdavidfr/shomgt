title: paramètres d'amélioration des GéoTiff lors de leur dallage et utilisés pour générer le shomgt.yaml
description: |
  Ce fichier contient 4 types de paramètres:
    - l'ordre dans lequel doivent être triés les GéoTiffs dans chaque couche défini par le z-order
    - la correction du rectangle définissant la zone cartographiée dans le GéoTiff
    - des zones à supprimer dans les GéoTiff
    - les bordures permettant de géoréférencer les GéoTiff qui ne le sont pas ou le sont mal
  
  L'amélioration des GéoTiff devrait utiliser ces paramètres de la manière suivante:
    - l'ordre des GéoTiffs est la solution la plus simple pour améliorer nettement le rendu des couches
    - avant de corriger le champ spatial, vérifier que la définition du catalogue est correcte
      - ne fournir un champ spatial dans ce fichier que si il est différent de celui porté sur la carte
    - la suppression de zones est longue à définir et devrait être exceptionnelle
    - de même la définition des bordures correspond à qualques cas particuliers
    
  11/6/2022:
    - effacement du coin SW du cartouche 7133_4_gtw Carteret
    - effacement du coin NW de la carte 7159 qui gène la lecture de la carte à plus petite échelle (Casquets)
  10/6/2022:
    - ajout effacement dans 7420_5_gtw et 7420_4_gtw correspondant à demande Jobourg CARTE_2
  4/6/2022:
    - pour le moment, les 3 seules façons d'appliquer un nouveau jeu de paramètres sont
      - soit de regénérer toutes les cartes
      - soit de supprimer manuellement les cartes qui doivent être refabriquées
      - soit en cas de changement uniquement d'ordre de regénérer à la main le fichier shomgt.yaml
  25/5/2022:
    - recopie des superpositions définies pour ShomGT2
$schema:
  title: Schéma JSON
  $schema: http://json-schema.org/schema#
  $id: http://geoapi.fr/shomgt3/sgupdt/maketile.schema.yaml
  definitions:
    pos:
      decription: position définie soit en dégrés-minutes dans une chaine, soit en degrés décimaux dans un array de 2 nombres
      oneOf:
        - description: |
            position en dégrés-minutes dans une chaine avec le même formattage  que celui utilisé par le Shom notamment
            dans les coins des cartes.
            Dans l'ordre latitude, longitude, avec la virgule comme séparateur de la partie décimale des minutes.
            La partie décimale des minutes peut être omise de même que la partie minute.
          type: string
          pattern: ^\d+°(\d\d(,\d+)?')?(N|S) - \d+°(\d\d(,\d+)?')?(E|W)$
          examples:
            - 42°39,93'N - 9°00,93'E
            - 42°39'N - 9°00'E
            - 42°N - 9°E
        - description: |
            position en degrés décimaux dans l'ordre longitude, latitude, définie par un array de 2 nombres, comme en GeoJSON
          type: array
          minItems: 2
          maxItems: 2
          items:
            type: number
    rect:
      description: |
        Rectangle géographique défini par les positions respectives des coordonnées SW et NE.
        Les latitudes sont comprises entre -90 et 90 et la latitude N est supérieure à la latitude S.
        Les longitudes sont sauf exceptions comprises entre -180 et +180.
        Normalement la longitude E est supérieure à la longitude W sauf lorsque le rectangle intersecte l'anti-méridien.
        Par exception, pour les quelques cartes dont l'extension en longitude est supérieure à 360°, la longitude E est
        supérieure à 180°.
      type: object
      required: [SW, NE]
      properties:
        SW:
          description: coin Sud-Ouest du rectangle
          $ref: '#/definitions/pos'
        NE:
          description: coin Nord-Est du rectangle
          $ref: '#/definitions/pos'
      examples:
        - {SW: "40°48,4'N - 7°50,4'E", NE: "43°18,9'N - 10°07,9'E"}
    polygon:
      description: |
        Polygone défini par une liste de positions
      type: array
      items:
        $ref: '#/definitions/pos'
      examples:
        -
          - 45°11,40'N - 0°17,50'W
          - 44°57,81'N - 0°17,50'W
          - 44°57,81'N - 0°24,32'W
          - 44°57,81'N - 0°24,32'W
          - 45°05,44'N - 0°33,62'W
          - 45°11,40'N - 0°33,62'W
    border:
      description: nbre de pixels d'une des 4 bordures, soit un entier soit une expression {number}-{number}
      oneOf:
        - type: integer
        - type: string
          pattern: \d+-\d+

  type: object
  additionalProperties: false
  properties:
    title: {type: string, description: titre du fichier}
    description: {type: string, description: commentaire sur le fichier}
    $schema:
      oneOf:
        - type: object
          $ref: http://json-schema.org/schema#
        - type: string
  patternProperties:
    ^\d\d\d\d(_pal300|_[\dA-Z]+_gtw|_\d+|)(.pdf)?$:
      description: |
        Chaque GéoTIFF est identifié par son nom qui correspond au nom du fichier contenant l'image
      type: object
      additionalProperties: false
      properties:
        title:
          description: titre du GéoTiff, utilisé pour faciliter la lecture du fichier
          type: string
        spatial:
          description: zone cartographiée dans le GéoTiff défini par un rectangle, remplace l'info du catalogue si présente
          $ref: '#/definitions/rect'
        z-order:
          description: |
            Par défaut dans chaque couche les GéoTiffs sont ordonnés par leur nom, ce qui signifie que celui
            ayant le plus grand numéro s'affiche au dessus des autres. Le z-order permet de modifier cet ordre.
            Un GéoTiff ayant un z-order supérieur à celui d'un autre s'affichera au-dessus de ce dernier.
          type: integer
          minimum: -99
          maximum: 99
        borders:
          decription: paramètre borders pour géoréférencer les GéoTiffs qui ne le sont pas
          type: object
          additionalProperties: false
          required: [left, top, right, bottom]
          properties:
            left:
              description: nbre de pixels à couper à gauche, soit un nombre soit une expression {number}-{number}
              $ref: '#/definitions/border'
            top:
              description: nbre de pixels à couper en haut, soit un nombre soit une expression {number}-{number}
              $ref: '#/definitions/border'
            right:
              description: nbre de pixels à couper à droite, soit un nombre soit une expression {number}-{number}
              $ref: '#/definitions/border'
            bottom:
              description: nbre de pixels à couper en bas, soit un nombre soit une expression {number}-{number}
              $ref: '#/definitions/border'
        toDelete:
          description: liste de zones à effacer dans le GéoTiff
          type: array
          items:
            description: la zone à effacer dans le GéoTiff est soit un rectangle soit un polygone
            oneOf:
              - description: définition de la zone par un rectangle
                type: object
                additionalProperties: false
                required: [rect]
                properties:
                  rect:
                    $ref: '#/definitions/rect'
              - description: définition de la zone par un polygone
                type: object
                additionalProperties: false
                required: [polygon]
                properties:
                  polygon:
                    $ref: '#/definitions/polygon'
        note:
          description: note

6623_pal300:
  z-order: 1 # > 6757_pal300
6948_pal300:
  z-order: 0 # 7482_pal300 < 6948_pal300 < 7302_pal300
6969_pal300:
  title: 6969 - Du Cap Corse à la Punta di l'Acciolu - Golfe de Saint-Florent
  z-order: -1 # 6969_pal300 en dessous de 6822_pal300 et de 6823_pal300
7081_pal300:
  title: Mer Méditerranée et mer Noire (Spéciale P)
  toDelete:
    - rect: {SW: [-7.0, 42.1797], NE: [2.1094, 49.8364]}
7120_pal300:
  z-order: 1 # 7120_pal300 > 7158_pal300
7133_4_gtw:
  title: 7133 - D - Carteret
  toDelete:
    - polygon: # effacement du coin SW du cartouche
        - [ -1.7914426, 49.3622692 ]
        - [ -1.7844695, 49.3622692 ]
        - [ -1.7914761, 49.3658498 ]
        - [ -1.7914426, 49.3622692 ]
7159_pal300:
  title: 7159 - De Guernsey, Herm et Sark à Alderney - Bancs des Casquets
  toDelete:
    - polygon: # effacement du coin NW de la carte qui gène la lecture de la carte à plus petite échelle 
        - 49°49,02'N - 2°43,71'W # coin NW
        - 49°49,02'N - 2°28'W # mi-chemin entre les coins NW et NE
        - 49°35'N - 2°43,71'W # mi-chemin entre les coins NW et SW
7204_pal300:
  z-order: 1 # > 7507_pal300
7210_pal300:
  z-order: 1 # > 7311_pal300
7420_5_gtw:
  title: Rade de Caen - Port de Ouistream
  toDelete:
    - polygon: # Effacement du Port de Caen (7420_4_gtw) qui apparait
        - [-0.15483388286219, 49.301145470209]
        - [-0.15372166989806, 49.231695228391]
        - [-0.24757533310195, 49.230801340912]
        - [-0.24783199763214, 49.240130494881]
        - [-0.17021236596237, 49.301173364641]
        - [-0.15483388286219, 49.301145470209]
7420_4_gtw:
  title: Port de Caen
  toDelete:
    - polygon: # Effacement de la rade de Caen (7420_5_gtw) qui apparait
        - [-0.36043821307259, 49.244333624641]
        - [-0.28420884760798, 49.244333624641]
        - [-0.35924044526506, 49.184059237147]
        - [-0.36043821307259, 49.244333624641]
7427_5_gtw:
  title: '7427-2 - La Gironde - La Garonne et La Dordogne (2/3)'
  #spatial: { SW: '44°50,18''N - 000°45,00''W', NE: '45°11,40''N - 000°17,50''W' }
  toDelete:
    - polygon: # Cartouche 7427-B - Port de Blaye
        - 45°11,40'N - 0°17,50'W
        - 44°57,81'N - 0°17,50'W
        - 44°57,81'N - 0°24,32'W
        - 44°57,81'N - 0°24,32'W
        - 45°05,44'N - 0°33,62'W
        - 45°11,40'N - 0°33,62'W
7482_pal300:
  z-order: -1 # 7482_pal300 < 6948_pal300 < 7302_pal300
7761_pal300:
  z-order: 1 # > 7762_pal300
7302_pal300:
  z-order: 1 # 7482_pal300 < 6948_pal300 < 7302_pal300
