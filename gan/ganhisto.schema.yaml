title: schema JSON du résultat de moissonnage du GAN avec historique des corrections
description: |
  La synthèse du GAN enregistre les infos issues du GAN à la date de sa moisson.
  Ainsi les infos des moissons précédentes sont perdues.
  Or, la liste des corrections apportées à une édition de carte reste intéressante alors qu'elle n'existe plus dans les GAN.
  Ainsi le fichier ganhisto.yaml a pour objectif de conserver l'historique des corrections contenues dans les moissonnages
  successifs du GAN.
$id: http://geoapi.fr/shomgt/gan/corrections.schema.yaml
$schema: http://json-schema.org/schema#

definitions:
  scale:
    description: "échelle sous la forme 1 : dd ddd"
    type: string
    pattern: '^1 : \d{1,3}( \d{3})*$'
    examples:
      - '1 : 1 008 000'
  dateIso8601:
    description: date au format ISO 8601 limité aux cas les plus fréquents
    type: string
    pattern: '^\d\d\d\d-\d\d-\d\d(T\d\d:\d\d(:\d\d(\.\d+)?)?)?([+-]\d\d:\d\d|Z)?$'
    examples:
      - '2020-01-10'
      - '2020-01-10T16:33'
      - '2020-01-10T16:33:34.56'
      - '2020-01-10T16:33:34.56+01:00'
      - '2020-01-10T16:33:34.56Z'
      - '2020-01-10T16:33+01:00'
      - '2020-01-10+01:00'
    counterexamples:
      - '2020-01-10T16'
  dateIntervalIso8601:
    description: intervalle de dates au format ISO 8601 limité à la date
    type: string
    pattern: '^\d{4}-\d\d-\d\d/\d\d\d\d-\d\d-\d\d$'
    examples:
      - '2020-01-10/2020-01-15'
  latLonDM:
    description: couple (latitude, longitude) en degrés minutes, structure fine non vérifiée
    type: string
    examples:
      - "44°09,00'N - 002°36,00'W"
      - "45°49,00'N - 001°00,00'W"
  spatial:
    description: boite englobante définie par ses 2 coins SW et NE, en degrés, minutes en WGS84
    type: object
    required: [SW, NE]
    additionalProperties: false
    properties:
      SW:
        description: latitude et longitude du coin SW en degrés minutes
        $ref: '#/definitions/latLonDM'
      NE:
        description: latitude et longitude du coin NE en degrés minutes
        $ref: '#/definitions/latLonDM'

type: object
required: [ title, $schema, valid, maps ]
additionalProperties: false
properties:
  title: { description: 'titre du document', type: string }
  $schema:
    description: 'schema JSON du document'
    oneOf:
      - $ref: http://json-schema.org/schema#
      - type: string
  valid:
    description: 'intervalle des dates de moisson des GANs'
    type: object
    additionalProperties: false
    required: [start, end]
    properties:
      start:
        description: date du premier moissonnage
        $ref: '#/definitions/dateIso8601'
      end:
        description: date du dernier moissonnage
        $ref: '#/definitions/dateIso8601'
  maps:
    description: dictionnaire des cartes par numéro de carte
    type: object
    additionalProperties: false
    patternProperties:
      ^\d{4}$:
        type: object
        additionalProperties: false
        properties:
          groupTitle:
            description: sur-titre optionnel identifiant un ensemble de cartes
            type: string
            examples:
              - Océan Pacifique Sud
          title:
            description: titre de la carte
            type: string
            examples:
              - Côte Ouest de Corse - Du Cap Corse au Golfe d'Ajaccio
          scale:
            description: |
              échelle sous la forme 1 : dd ddd
              Champ absent ssi la carte ne comporte pas d'espace principal.
            $ref: '#/definitions/scale'
          edition:
            description: édition courante de la carte
            type: string
            pattern: ^(Edition n°\d+ -)|(Publication) \d{4}$
            examples:
              - Édition n° 3 - 2018
              - Publication 2017
          spatial:
            description: |
              boite englobante de l'espace principal de la carte en degrés, minutes en WGS84,
              Champ absent ssi la carte ne comporte pas d'espace principal.
            $ref: '#/definitions/spatial'
          inSets:
            description: liste éventuelle de cartouches
            type: array
            minItems: 1
            items:
              type: object
              additionalProperties: false
              required: [title, scale, spatial]
              properties:
                title:
                  description: titre du cartouche
                  type: string
                scale:
                  description: "échelle sous la forme 1 : dd ddd"
                  $ref: '#/definitions/scale'
                spatial:
                  description: boite englobante du cartouche en degrés, minutes en WGS84
                  $ref: '#/definitions/spatial'
          valid:
            description: 'date de moisson du GAN pour cette carte'
            $ref: '#/definitions/dateIso8601'
          corrections:
            description: |
              dictionnaire des corrections de cette carte défini par édition.
              Un objet vide signfie qu'aucune correction n'est enregistrée pour cette carte.
            type: object
            additionalProperties: false
            patternProperties:
              ^(Edition n°\d+ -)|(Publication) \d{4}$:
                description: corrections pour cette édition de cette carte structurée comme dictionnaire par no de correction
                type: object
                additionalProperties: false
                patternProperties:
                  ^c\d+$:
                    description: correction identifiée par son numéro
                    type: object
                    additionalProperties: false
                    required: [semaineAvis, valid]
                    properties:
                      semaineAvis:
                        description: |
                          numéro de semaine sur quatre chiffres et numéro d'avis pour cette semaine
                          Exemple, '1905-252' signifie avis 252 du GAN de la semaine 05 de 2019
                        type: string
                        pattern: '^\d{4}-\d+$'
                        examples:
                          - 1905-252
                      valid:
                        description: date du dernier moissonnage de cette correction
                        $ref: '#/definitions/dateIso8601'
  eof: {type: 'null'}
