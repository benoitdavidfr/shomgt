title: ShomGt3 - reconception de ShomGt restreignant la partie à héberger
path: /geoapi/shomgt3
doc: |
  Nouvelle version de ShomGT axée sur l'amélioration de la distribution du code sous la forme de conteneurs Docker.
  L'idée principale est de distribuer ShomGT aux CROSS sous la forme:
    - un docker-compose lancant 2 conteneurs
      - le conteneur shomgt qui expose les services de tuiles et WMS à partir des données de cartes expansées
      - le conteneur sgupdt qui construit les données de cartes expansées à partir d'un serveur de cartes
    - un serveur de cartes sgserver qui est centralisé et mis à jour régulièrement
  Enfin, il est nécessaire d'utiliser le module cat2 de shomgt2 pour récupérer certains paramètres des GéoTiffs.
  
  Les modules shomgt et sgupdt peuvent fonctionner soit en conteneur spécifique, soit dans le conteneur général.
  shomgt consome le répertoire data contenant les données de cartes expansées et le fichier shomgt.yaml,
  qui est construit et mis à jour par sgupdt.
  
  Les 2 conteneurs et le serveur sgserver devraient pouvoir être hébergés sur l'offre Compose d'ECO.
  
  Voir le fichier filetree.yaml pour l'arborescence des fichiers, les mapping dans les conteneurs et les vars d'environnement

journal: |
  10/6/2022:
    - création images docker 0.5
  8-9/6/2022:
    - ajout serveur WMS
  7/6/2022:
    - ajout érosion de l'encombrement des cartes pour effacer les traits des bords des cartes
  6/6/2022:
    - réécriture de l'utilisation de gdalinfo, utilisation de la sortie json, suppression de la détection du CRS
    - portage de sgupdt et shomgt sur Alwaysdata avec la totalité des cartes
      - Alwaysdata propose une version ancienne de gdalinfo qui ne fournit pas la même version de WKT
    - correction d'un bug dans le calcul du niveau de zoom pour afficher la couche pyramide
    - test OK sur OVH de la version 0.4 des images
  5/6/2022:
    - correction massive des bboxDM de mapcat à partir du GAN
    - suppression dans mapcat du chmap spatial et renommage de bboxDM en spatial
  3/6/2022:
    - fonctionnement OK du docker-compose au CROSS Corsen avec les images v0.3
  30/5/2022:
    - ajout effacement du cache des tuiles dans sgupdt
    - correction bugs
  26/5/2022:
    - ajout du cache des tuiles dans shomgt
    - nécessité de réfléchir à la gestion des logs, notamment utiliser ELK
  25/5/2022:
    - ajout du z-order dans sgupdt ; def. des z-order dans update.yaml ; effacement partiel de 7081
  24/5/2022:
    - version 0.3 semble ok y compris en conteneurs sur OVH
    - manque
      - la gestion de l'ordre des couches dans sgupdt - FAIT 25/5
      - le cache de tuiles dans shomgt - fAIT 26/5
      - le serveur WMS dans shomgt
  17/5/2022:
    - 1ère version Ok
    - manque encore plusieurs parties
      - tester sgupdt sous la forme d'un conteneur
      - ajouter le service wms à shomgt
      - ajouter le cache de tuiles à shomgt
  9/5/2022:
    - changement d'architecture, les cartes ne peuvent pas être intégrées dans les images Docker
      - définition d'un conteneur sgupdt chargé de télécharger les cartes et du serveur sgserver correspondant
      - abandon du module build qui servait à construire les cartes à embarquer dans l'image Docker
  7/5/2022:
    - réorg des fichiers, le module maps est renommé en shomgt
  6/5/2022:
    - améliorations du container maps
    - mise en place de docker-compose et Traefik
  27/4/2022:
    - améliorations du container maps
  24/4/2022:
    - mise en oeuvre container maps
  23/4/2022:
    - ajout réflexions
  16/4/2022:
    - ajout réflexions
  5/4/2022:
    - création
submodules:
  - /geoapi/shomgt3/shomgt
  - /geoapi/shomgt3/sgupdt
  - /geoapi/shomgt3/sgserver
  - /geoapi/shomgt3/mapcat
phpScripts:
phpIncludes:
htmlFiles:
  - docker-compose.yml
